/**
 * Tabå¯¼èˆªæœåŠ¡
 * ç”¨äºç®¡ç†Tabé¡µé¢é—´çš„å¯¼èˆªå’ŒçŠ¶æ€åŒæ­¥
 */
export class TabNavigationService {
  private static instance: TabNavigationService;
  private currentTabIndex: number = 0;

  private constructor() {}

  static getInstance(): TabNavigationService {
    if (!TabNavigationService.instance) {
      TabNavigationService.instance = new TabNavigationService();
    }
    return TabNavigationService.instance;
  }

  /**
   * è·å–å½“å‰Tabç´¢å¼•
   */
  getCurrentTabIndex(): number {
    return this.currentTabIndex;
  }

  /**
   * è®¾ç½®å½“å‰Tabç´¢å¼•
   * @param index Tabç´¢å¼•
   */
  setCurrentTabIndex(index: number): void {
    this.currentTabIndex = index;
  }

  /**
   * åˆ‡æ¢åˆ°ä»Šæ—¥ç»ƒä¹ Tab
   */
  switchToToday(): void {
    this.currentTabIndex = 0;
  }

  /**
   * åˆ‡æ¢åˆ°å­¦ä¹ è·¯çº¿Tab
   */
  switchToLearningPath(): void {
    this.currentTabIndex = 1;
  }

  /**
   * åˆ‡æ¢åˆ°ç»ƒä¹ ä¸­å¿ƒTab
   */
  switchToPracticeCenter(): void {
    console.info('ğŸ“± TabNavigationService: åˆ‡æ¢åˆ°ç»ƒä¹ ä¸­å¿ƒ');
    this.currentTabIndex = 2;
    // ä½¿ç”¨AppStorageé€šçŸ¥Indexé¡µé¢åˆ‡æ¢Tab
    AppStorage.setOrCreate('switchToTabIndex', 2);
    console.info('âœ… å·²å‘é€åˆ‡æ¢ä¿¡å·åˆ°Indexé¡µé¢');
  }

  /**
   * åˆ‡æ¢åˆ°æ¨¡æ‹Ÿè€ƒè¯•Tabï¼Œå¹¶è§¦å‘æ•°æ®åˆ·æ–°
   */
  switchToExam(): void {
    console.info('ğŸ“± TabNavigationService: åˆ‡æ¢åˆ°æ¨¡æ‹Ÿè€ƒè¯•');
    this.currentTabIndex = 3;
    // ä½¿ç”¨AppStorageé€šçŸ¥Indexé¡µé¢åˆ‡æ¢Tab
    AppStorage.setOrCreate('switchToTabIndex', 3);
    // è§¦å‘ExamPageæ•°æ®åˆ·æ–°
    this.triggerExamDataRefresh();
    console.info('âœ… å·²å‘é€åˆ‡æ¢ä¿¡å·åˆ°Indexé¡µé¢');
  }

  /**
   * åˆ‡æ¢åˆ°ç»Ÿè®¡é¡µé¢Tab
   */
  switchToStatistics(): void {
    this.currentTabIndex = 4;
  }

  /**
   * è§¦å‘è€ƒè¯•æ•°æ®åˆ·æ–°
   */
  private triggerExamDataRefresh(): void {
    const currentTrigger = AppStorage.get<number>('examDataRefreshTrigger') || 0;
    AppStorage.setOrCreate('examDataRefreshTrigger', currentTrigger + 1);
  }

  /**
   * è§¦å‘è€ƒè¯•è®°å½•æ›´æ–°
   */
  static triggerExamRecordUpdate(): void {
    const currentTrigger = AppStorage.get<number>('examDataRefreshTrigger') || 0;
    AppStorage.setOrCreate('examDataRefreshTrigger', currentTrigger + 1);
  }

  /**
   * è§¦å‘è€ƒè¯•å®Œæˆäº‹ä»¶
   */
  static triggerExamCompleted(): void {
    const currentTrigger = AppStorage.get<number>('examDataRefreshTrigger') || 0;
    AppStorage.setOrCreate('examDataRefreshTrigger', currentTrigger + 1);
  }
}